pipeline {
  agent any
  environment {
    DIRECTORY_PATH = "C:/Users/lokesh r/Documents/Jenkinsfile.txt"
    TESTING_ENVIRONMENT = "QA"
    PRODUCTION_ENVIRONMENT = "Lokesh"
    EMAIL_RECIPIENT = "lokeshravichandran59@gmail.com"
  }
  stages {
    stage('Build') {
      steps {
        echo "Stage 1: Building the code using Maven and GitLab CI/CD"
      }
    }
    stage('Unit and Integration Tests') {
      steps {
        echo "Stage 2: Running unit tests and integration tests using Jest"
        // Simulate creation of test log file for attachment
        writeFile file: 'test-results.log', text: 'Test results log content'
      }
      post {
        success {
          archiveArtifacts artifacts: 'test-results.log', allowEmptyArchive: true
          emailext(
            to: "${EMAIL_RECIPIENT}",
            subject: "Unit and Integration Tests Passed",
            body: "The Unit and Integration Tests stage was successful.",
            attachments: 'test-results.log', // Attach the log file
            attachLog: true
          )
        }
        failure {
          archiveArtifacts artifacts: 'test-results.log', allowEmptyArchive: true
          emailext(
            to: "${EMAIL_RECIPIENT}",
            subject: "Unit and Integration Tests Failed",
            body: "The Unit and Integration Tests stage failed. Please check the attached logs for details.",
            attachments: 'test-results.log', // Attach the log file
            attachLog: true
          )
        }
      }
    }
    stage('Code Analysis') {
      steps {
        echo "Stage 3: Integrate a code analysis tool to analyze the code using Jenkins"
      }
    }
    stage('Security Scan') {
      steps {
        echo "Stage 4: Performing a security scan using Burp Suite"
        // Simulate creation of security log file for attachment
        writeFile file: 'security-scan.log', text: 'Security scan log content'
      }
      post {
        success {
         archiveArtifacts artifacts: 'security-scan.log', allowEmptyArchive: true
          emailext(
            to: "${EMAIL_RECIPIENT}",
            subject: "Security Scan Passed",
            body: "The Security Scan stage was successful.",
            attachments: 'security-scan.log', // Attach the log file
            attachLog: true
          )
        }
        failure {
          archiveArtifacts artifacts: 'security-scan.log', allowEmptyArchive: true
          emailext(
            to: "${EMAIL_RECIPIENT}",
            subject: "Security Scan Failed",
            body: "The Security Scan stage failed. Please check the attached logs for details.",
            attachments: 'security-scan.log', // Attach the log file
            attachLog: true
          )
        }
      }
    }
    stage('Deploy to Staging') {
      steps {
        echo "Stage 5: Deploying the application to the staging server using AWS"
      }
    }
    stage('Integration Tests on Staging') {
      steps {
        echo "Stage 6: Running integration tests on the staging environment"
      }
    }
    stage('Deploy to Production') {
      steps {
        echo "Stage 7: Deploying the application to the production server using AWS"
      }
    }
  }
  post {
    success {
      echo "Pipeline completed successfully!"
    }
    failure {
      echo "Pipeline failed."
    }
  }
}
